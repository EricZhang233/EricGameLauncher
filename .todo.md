# 待办事项 / To-Do List

## 近期计划 (Planned)

### 1. 修复 `Process.Start` 参数拼接转义风险 (Audit 1.2)
**描述**: 针对包含空格和双引号的启动路径，使用 `ArgumentList` 进行安全传参，或者对所有通过 `Arguments` 传递的路径进行更严格的 `Replace("\"", "\\\"")` 逃逸处理，防止因命令闭合不严导致的注入或解析错误风险。
**相关文件**: `MainWindow.xaml.cs` (如 `cfgUpdaterPath` 和 Explorer 调起相关逻辑)。

### 2. 增强更新器的健壮性并添加出错回滚 (Audit 2.1)
**描述**: 更新器目前的 `try { file.Delete() }` 会在文件被占用时静默失败。如果后续 `ExtractToFile` 抛出异常，会导致旧文件已部分损坏，新文件也未能完全写入，从而使启动器彻底报废。
**修复方案** (影子替换机制): 
1. 先将新的 ZIP 解压到一个临时更新目录。
2. 验证解压完整无误后，再快速进行现有文件的删除或移动替换。最好能先将原有目录 rename 作为备份。
3. 如果覆盖期间引发异常，可立刻从 rename 的备份还原。
**相关文件**: `updater.main/Program.cs`

---

## 目前未排期区域 (Currently Unscheduled)

### 3. IconHelper 缓存优化与内存抖动修复 (Audit 3.1)
**描述**: 当前仅依靠 `LastWriteTime.Ticks` 作为缓存 Key 拼接在 URI 后面，大量并发加载图片时，底层缓存查表或重建 URI 仍有微小性能开销或抖动。
**方案**: 引入全局级别的驻留字典（如 `ConcurrentDictionary`）来进行解码后的 `BitmapImage` 软引用的直接缓存，彻底避免 UI 线程等待。

### 4. 扫描引擎防重检测优化 (Audit 3.2)
**描述**: 现有的非 UWP 游戏防重复逻辑仅比较了 `ExePath` 和 `Title`。在存在多重快捷方式、修改过启动参数的路径不同版本情况下，易产生重复导入。
**方案**: 引入更复杂的去重判定，例如计算目标可执行文件的摘要信息或规范化物理真实路径来做匹配。
